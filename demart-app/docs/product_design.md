# DeMart 产品设计文档 (Product Requirement Document)

> **文档状态**: `草稿`
> **创建日期**: `2024-08-01`
> **负责人**: `资深产品经理`

---

## 1. 产品概述与愿景 (Overview & Vision)

### 1.1. 产品简介

DeMart 是一个基于区块链技术的去中心化 C2C (Consumer-to-Consumer) 交易平台。用户可以在平台上自由交易实体商品、在线服务或虚拟物品。平台利用稳定币 (Stablecoin) 作为主要交易媒介，并通过智能合约实现交易资金的托管与担保，旨在打造一个更安全、更低成本、更透明的全球化C2C市场。

### 1.2. 产品愿景

我们的愿景是构建一个由社区驱动、无需第三方信任、无国界限制的自由交易市场。通过移除中心化机构的干预，将价值和权利真正交还给买卖双方，让每一次交易都简单、可靠。

### 1.3. 产品定位与目标

**一句话定位**: 一个类似“闲鱼”模式的去中心化C2C闲置与服务交易平台。

**目标市场**:
*   **初期**: 面向熟悉并持有加密货币的用户，特别是那些寻求更高交易自主性和更低交易成本的用户群体。
*   **长期**: 逐步降低使用门槛，吸引更广泛的传统电商用户，成为Web3时代的主流C2C交易平台之一。

### 1.4. 核心解决的问题 (Pain Points)

DeMart 致力于解决当前C2C交易市场（尤其是中心化平台）存在的以下核心问题：

| 问题点 (Pain Point) | 中心化平台现状 | DeMart 解决方案 (Decentralized Solution) |
| :--- | :--- | :--- |
| **信任成本高** | 依赖平台作为信用背书，但平台本身可能存在数据滥用、规则不透明等问题。 | 通过公开、不可篡改的智能合约来执行交易规则，代码即法律，建立程序化的信任。 |
| **交易成本高** | 平台通常会抽取较高比例的佣金（例如 5%-20%）来维持运营和盈利。 | 去中心化运营极大降低了维护成本，平台仅收取极低的费用（或初期不收费）以维持协议运行。 |
| **资金结算慢** | 资金通常有较长的结算周期，且提现流程繁琐，受银行和支付网关限制。 | 使用稳定币交易，资金在买家确认后即刻通过智能合约划转至卖家钱包，实现近乎实时的全球结算。 |
| **审查与限制** | 平台基于自身规则和地区法规，对可上架的商品类型有严格限制，缺乏灵活性。 | 赋予用户更高的自主权，只要交易内容合法合规，社区可以自由决定上架的商品与服务类型。 |
| **单点故障风险** | 中心化服务器一旦宕机或被攻击，整个平台将陷入瘫痪。 | 核心逻辑部署在区块链上，数据分布式存储（例如使用 IPFS），具备高可用性和抗审查能力。 | 

---

## 2. 用户角色与场景分析 (User Roles & Scenarios)

### 2.1. 用户角色 (User Personas)

在 DeMart 平台中，一个用户可以同时扮演卖家和买家的角色。为了更好地理解他们的需求和行为，我们构建以下两个核心用户画像：

**角色一：卖家 (Seller) - Alex**

*   **背景**: 28岁，一名居住在东南亚的自由职业设计师。他是加密货币早期采用者，对 Web3 技术充满热情。
*   **行为特征**:
    *   经常在各种平台上出售自己的设计服务和一些闲置的电子产品。
    *   对个人数据隐私非常敏感。
    *   熟悉使用加密钱包（如 MetaMask）进行转账。
    *   愿意尝试新平台，尤其是那些能提供更低交易费用和更高自主性的平台。
*   **目标 (Goals)**:
    *   快速、轻松地发布自己的商品或服务。
    *   以稳定币的形式获得收入，避免法币汇率波动和复杂的国际收款流程。
    *   以尽可能低的成本完成交易。
    *   建立自己的个人品牌和信誉。
*   **痛点 (Pain Points)**:
    *   传统平台佣金太高，侵蚀了利润。
    *   收款周期长，国际收款手续繁琐且费用高昂。
    *   担心平台随意下架自己的商品或封禁账户。

**角色二：买家 (Buyer) - Bella**

*   **背景**: 22岁，一名在美国的大学生。她对数字时尚和虚拟商品很感兴趣，并持有一些稳定币用于小额投资和支付。
*   **行为特征**:
    *   喜欢寻找独特和小众的商品，包括虚拟物品和独立设计师的作品。
    *   对交易安全非常看重，担心遇到欺诈卖家（付款不发货）。
    *   希望购物体验流畅、简单，不希望有复杂的注册和验证流程。
*   **目标 (Goals)**:
    *   安全地购买商品，确保在收到货之前资金是受保护的。
    *   能够方便地使用自己持有的稳定币进行支付。
    *   能够查看卖家的信誉历史，以辅助购买决策。
    *   在发生纠纷时，有一个公平、透明的裁决机制。
*   **痛点 (Pain Points)**:
    *   在传统C2C平台遇到过诈骗，付了款但卖家消失了。
    *   跨境购买时，支付方式受限，且运费和关税不透明。
    *   担心自己的购买历史和个人信息被平台泄露。

### 2.2. 核心用户故事 (Key User Stories)

| 作为... (As a...) | 我想要... (I want to...) | 以便... (So that...) |
| :--- | :--- | :--- |
| **一个新用户** | 通过连接我的加密钱包快速创建账户 | 无需经历传统平台繁琐的手机/邮箱注册和KYC流程。 |
| **卖家 (Seller)** | 通过简单的表单（标题、描述、图片、价格）发布一件商品 | 快速将我的闲置物品或服务上架销售。 |
| **卖家 (Seller)** | 自定义我的个人主页，展示我正在出售的所有商品 | 打造我的个人店铺品牌，方便买家浏览。 |
| **卖家 (Seller)** | 在买家确认收货后，资金能立刻转入我的钱包 | 快速回笼资金，避免漫长的结算等待。 |
| **买家 (Buyer)** | 按分类或通过关键词搜索我感兴趣的商品 | 高效地找到我想要购买的东西。 |
| **买家 (Buyer)** | 在支付后，我的资金被一个可信的第三方（智能合约）托管 | 防止卖家收到钱后不发货，保障我的资金安全。 |
| **买家 (Buyer)** | 查看卖家的历史交易记录和收到的评价 | 评估卖家的可信度，做出更明智的购买决策。 |
| **买家 (Buyer)** | 在收到不满意的商品时，可以方便地发起退款或申诉 | 保护我的消费者权益。 |

---

## 3. 核心业务流程 (Core Business Flow)

### 3.1. 整体交易流程图 (Overall Transaction Flow)

下面的流程图展示了在 DeMart 平台上一次完整的C2C交易所经历的关键步骤。

```mermaid
graph TD
    subgraph 卖家 (Seller)
        A[连接钱包创建账户] --> B{发布商品};
        B --> C[商品信息上链/IPFS];
        L[发货] --> M{链上标记为已发货};
        P[资金到账] --> Q[完成交易];
    end

    subgraph 买家 (Buyer)
        D[连接钱包创建账户] --> E{浏览/搜索商品};
        E --> F[查看商品详情];
        F --> G[下单];
        G --> H{调用智能合约支付};
        H --> I[资金进入托管合约];
        N[收到商品] --> O{确认收货};
        R[评价卖家] --> S[交易记录上链];
    end

    subgraph 智能合约 (Smart Contract)
        I -- 资金锁定 --> J{等待条件触发};
        J -- 买家确认收货 --> K[自动转账给卖家];
        J -- 或, 发货后超时自动确认 --> K;
        K --> P;
    end

    C --> E;
    I -- 支付成功 --> L;
    M --> N;
    O --> J;
```

---

## 4. 功能规格 (Features Spec)

本章节将详细定义 DeMart 平台的核心功能。我们将采用 MVP (Minimum Viable Product) 的策略，优先实现最核心的功能，以快速验证产品理念。

### 4.1. 用户与身份模块 (MVP)

| 功能点 | 描述 | 备注 |
| :--- | :--- | :--- |
| **钱包连接** | 用户无需传统注册，通过连接其兼容EVM的钱包（如MetaMask）即可创建账户并登录。 | 平台将使用用户的钱包地址作为其唯一标识符 (UID)。 |
| **用户主页** | 自动为每个用户生成一个个人主页，URL可以设计为 `demart.com/0x...`。 | 主页上展示用户的基本信息（头像、昵称）、信誉积分、以及其正在出售的商品列表。 |
| **编辑个人资料** | 用户可以自定义其主页上显示的昵称和头像。 | 这些信息存储在中心化服务器或去中心化存储（如Ceramic Network）上，而非直接上链以节省成本。 |

### 4.2. 商品模块 (MVP)

| 功能点 | 描述 | 备注 |
| :--- | :--- | :--- |
| **发布商品** | 卖家可以填写表单来发布新商品，包含：标题、描述、上传图片、设定价格（以稳定币计价）、商品分类、以及**商品所在地理位置（国家/地区）**。 | 商品的元数据（描述、图片链接）将存储在 IPFS 上，并将 IPFS 的哈希值记录在链上，确保内容不可篡改。对于虚拟商品/服务，地理位置可设为“全球/不适用”。 |
| **商品列表与搜索** | 平台首页以瀑布流形式展示所有上架商品。提供基础的关键词搜索功能，并**增加地理位置筛选**。 | MVP阶段的搜索和筛选功能可以基于中心化服务器实现，以获得更好的性能。 |
| **商品详情页** | 展示商品的详细信息、图片、价格、卖家信息（头像、昵称、信誉）以及卖家的其他商品。 | |
| **管理商品** | 卖家可以编辑或下架自己已发布的商品。 | 编辑操作会产生新的IPFS记录，并在链上更新哈希。 |

### 4.3. 交易与支付模块 (MVP)

| 功能点 | 描述 | 备注 |
| :--- | :--- | :--- |
| **创建订单** | 买家点击“购买”后，生成一个订单，进入待支付状态。 | |
| **托管支付** | 买家调用智能合约进行支付。支付的稳定币（如USDC/USDT）被锁定在交易专用的托管智能合约中。 | 这是保障买家资金安全的核心机制。合约地址和状态对买卖双方公开可见。 |
| **标记发货** | 卖家在发货后，在订单页面上点击“我已发货”，并将物流信息（可选）记录下来。此操作会通知买家。 | 链上状态同步更新为“已发货”。 |
| **确认收货** | 买家收到货后，点击“确认收货”。此操作将触发托管合约，将资金释放给卖家。 | 这是资金结算的关键步骤。 |
| **超时自动确认** | 如果卖家标记发货后，在预设的时间内（例如14天）买家未确认也未发起争议，系统将自动确认收货。 | 防止买家恶意不确认，保障卖家权益。该逻辑由智能合约执行。 |

### 4.4. 信誉与评价系统 (MVP)

| 功能点 | 描述 | 备注 |
| :--- | :--- | :--- |
| **交易后互评** | 交易完成后（资金已释放），买卖双方可以相互留下评价（例如1-5星）和文字评论。 | 评价内容和星级将记录在链上，与该笔交易绑定，确保真实可追溯。 |
| **信誉分计算** | 用户的信誉分将基于其收到的所有评价进行加权平均计算。 | 信誉分直接展示在用户的个人主页和商品详情页，作为其他用户的决策参考。 |

---

## 5. 技术架构思考 (Technical Architecture Considerations)

本章节从产品角度出发，为技术团队提供架构设计和技术选型上的参考与建议。

### 5.1. 核心原则

*   **安全第一**: 智能合约必须经过严格的审计，用户的资金安全是最高优先级。
*   **去中心化与性能的平衡**: 并非所有数据和逻辑都需要上链。应将核心的、需要信任保障的逻辑（如资金托管、交易状态机）放在链上，而将其他辅助性功能（如商品搜索、用户资料）置于链下，以平衡去中心化、成本和用户体验。
*   **用户体验优先**: 尽可能降低Web3操作的复杂性，让不熟悉加密钱包的用户也能相对顺畅地使用。

### 5.2. 技术栈建议 (Tech Stack Suggestions)

| 层面 | 建议技术 | 理由 |
| :--- | :--- | :--- |
| **区块链网络** | 优先考虑兼容EVM的Layer2网络，如 Arbitrum, Optimism, Base, Polygon 等。 | 相比以太坊主网，Layer2提供极低的Gas费用和更快的交易确认速度，这对于频繁交易的电商场景至关重要。 |
| **智能合约** | Solidity, OpenZeppelin Contracts | Solidity是主流的智能合约语言。使用经过审计的OpenZeppelin标准库（如ERC20, Ownable）可以极大提升合约的安全性。 |
| **稳定币选项** | USDC, USDT | 选择流动性最好、市场接受度最高的稳定币，便于用户持有和交易。 |
| **去中心化存储** | IPFS (InterPlanetary File System) | 用于存储商品图片、描述等元数据。IPFS通过内容寻址，确保数据一旦上传就无法被篡改，与区块链形成完美配合。 |
| **链下数据索引** | The Graph Protocol | The Graph 可以高效地索引链上数据，为前端提供快速、可靠的数据查询API，避免前端直接与RPC节点进行复杂交互。 |
| **用户身份数据** | Ceramic Network (可选) | 对于用户的个人资料（昵称、头像），可以考虑使用Ceramic等去中心化身份解决方案，让用户真正拥有自己的数据。MVP阶段可先用中心化服务器。|
| **前端框架** | React / Next.js, Vue / Nuxt.js | 成熟的前端框架，拥有庞大的社区和丰富的Web3库支持（如 Ethers.js, Wagmi.sh）。 |

### 5.3. 关于 Gas 费的思考

Gas 费是用户在区块链上执行操作所需支付的费用，是去中心化应用必须面对的用户体验挑战。

*   **网络选择**: 如上所述，选择Layer2是降低Gas费最有效的手段。
*   **合约优化**: 在开发智能合约时，应精简化设计，避免不必要的链上写入操作，以降低执行成本。例如，将多个状态更新捆绑在一次交易中。
*   **Gasless (无Gas) 交易**: 长期来看，可以探索使用账户抽象 (Account Abstraction) 或元交易 (Meta-transactions) 等技术。平台可以为特定操作（如首次发布商品、留下评价）代付Gas费，以极大地改善新用户的体验。这可以作为后续版本的功能规划。

---

## 6. 后续迭代计划 (Roadmap)

DeMart 的发展将遵循“快速上线、持续迭代”的原则。以下是产品上线后的迭代路线图。

### 6.1. 短期优化 (MVP 上线后)

*   **性能优化**: 根据真实用户数据，优化The Graph的索引效率和前端加载速度。
*   **用户引导**: 在产品内增加更清晰的新手引导，帮助Web2用户理解钱包连接、支付等核心操作。
*   **多语言支持**: 增加除英文外的其他语言支持，如中文、西班牙语等，以拓展全球市场。
*   **移动端适配**: 优化移动端浏览器（特别是钱包自带浏览器）的访问体验。

### 6.2. 中期发展 (上线后 3-6 个月)

*   **私信聊天功能**: 允许买卖双方在下单前进行点对点的加密聊天，沟通商品细节。可使用 XMTP 等去中心化通讯协议。
*   **高级搜索与筛选**: 增加按价格区间、商品分类、卖家信誉分等条件筛选的功能。
*   **去中心化争议仲裁**: 引入基于Kleros或类似协议的去中心化仲裁系统。当买卖双方发生争议时，由社区陪审员投票决定资金归属，取代平台客服，实现更公正的纠纷处理。
*   **支持更多稳定币**: 集成更多种类的稳定币，为用户提供更多支付选择。
*   **优惠/折扣功能**: 允许卖家创建优惠码或对特定商品进行限时折扣。

### 6.3. 长期愿景 (上线后 6-12 个月及更远)

*   **平台币与经济模型**: 设计并发行DeMart平台的功能型代币（Token），用于交易手续费折扣、参与治理、激励早期用户等。
*   **社区治理 (DAO)**: 将平台的关键决策权（如手续费率、仲裁规则、新功能开发优先级）逐步移交给代币持有者，通过DAO的形式进行社区共治。
*   **DeFi 集成**: 探索将交易托管资金与DeFi协议（如Aave, Compound）集成的可能性，让用户在等待交易确认期间也能获得链上收益。
*   **多链部署**: 将DeMart部署到更多主流的公链或Layer2上，捕获不同生态的用户。
*   **开放平台API**: 允许第三方开发者基于DeMart的协议构建自己的客户端或集成DeMart的交易功能。 

---

## 7. 安全、合规与信任策略 (Safety, Compliance & Trust)

去中心化平台面临的核心挑战之一是如何在保障用户隐私和自由的同时，防范非法活动并建立生态信任。本章节阐述 DeMart 在此方面的多层次策略。

### 7.1. 核心原则

*   **提高作恶门槛，而非追求完全杜绝**: 在开放的去中心化网络中，无法100%杜绝非法活动。我们的策略核心是，通过技术和经济模型的设计，极大地提高违法成本，使其得不偿失。
*   **分层防御**: 结合链上分析、中心化预警和社区治理，构建一个纵深防御体系。
*   **有限的中心化妥协**: 为了保护绝大多数善意用户和平台的长期发展，在特定环节（如入口准入、内容预警）采用必要的中心化手段是可以接受的。

### 7.2. 多层次安全与合规框架

**第一层：准入层 - 链上身份与资金分析 (MVP)**

*   **功能**: 在用户连接钱包时，通过集成第三方链上分析工具（如 Chainalysis, TRM Labs）的API，对钱包地址进行风险评估。
*   **规则**:
    *   **高风险地址**: 若地址被标记为与混币器、暗网、被盗资金或受制裁实体直接关联，前端将直接阻止其登录和使用平台。
    *   **中风险地址**: 允许登录，但限制发布商品等高风险操作。
    *   **低风险/合规地址**: 授予全部功能权限。
*   **目的**: 从源头上筛选掉高风险参与者，保障平台基础安全。

**第二层：内容层 - AI内容预警 (MVP)**

*   **功能**: 在卖家提交商品信息时，其上传的图片和文本描述将先通过中心化的AI服务进行扫描。
*   **规则**: 利用成熟的云服务（如 Google Vision AI）或自训练模型，识别涉及违禁品（毒品、武器）、暴力、色情等内容。
*   **处理**: 若检测到高风险内容，则直接阻止本次发布，并向卖家返回“内容不合规”的提示。商品元数据不会被上传至IPFS或上链。
*   **目的**: 自动化、前置化地拦截大部分明目张胆的非法商品。

**第三层：社区层 - 去中心化举报与仲裁 (中期路线图)**

*   **功能**: 赋予社区用户监督和治理的权利。
*   **举报机制**:
    *   用户可在商品页面点击“举报”。
    *   举报时需质押少量资金（Stake-to-Report），以防止恶意举报。
*   **仲裁机制**:
    *   被举报的商品将进入去中心化仲裁流程（可集成 Kleros 等第三方协议）。
    *   由质押代币的社区“陪审员”对举报进行投票。
*   **执行**:
    *   若举报成立，举报者收回质押并获得奖励，作恶卖家的信誉分降低或地址被标记；被举报商品将从前端索引中移除。
    *   若举报不成立，举报者的质押金将被没收一部分给被举报者作为补偿。
*   **目的**: 依靠集体智慧，实现生态的长期、可持续治理和净化。 

---

## 8. 社区治理与内容审查模型 (Community Governance & Curation Model)

本章节深入探讨DeMart如何利用集体智慧，构建一个强大且可行的社区自我调节机制。这是平台长期健康发展的基石。

### 8.1. 治理理念

*   **渐进式去中心化**: 平台启动初期由核心团队引导，随着社区的成熟，逐步将权力移交给由代币持有者组成的DAO。
*   **经济激励驱动**: 系统的核心是“激励相容”。我们通过精心设计的经济模型，使个人利益（获得奖励）与集体利益（维护平台环境）保持一致。
*   **透明与可验证**: 所有治理与仲裁的关键流程，包括投票和裁决，都将记录在链上，任何人都可以公开验证，确保过程的公正性。

### 8.2. 核心角色与职责

| 角色 | 资格 | 核心职责 |
| :--- | :--- | :--- |
| **普通用户** | 连接钱包即可 | 浏览、交易、以及对可疑商品发起**举报**。 |
| **陪审员 (Juror)** | 质押平台代币 `$DMT` | 参与被举报案件的**审查与投票**，是社区治理的核心力量。 |
| **治理委员会** | 多重签名钱包的持有者 (初期) | 负责引导系统、处理极端争议，以及执行社区投票通过的协议升级。 |

### 8.3. 去中心化内容审查流程

以下流程图详细说明了从举报到裁决的全过程，该过程将由智能合约驱动。

```mermaid
graph TD
    A[用户发现违规商品] --> B{发起举报并质押少量USDT};
    B --> C[案件生成，进入仲裁池];
    C --> D{智能合约从陪审员池中<br/>随机抽取7名陪审员};

    subgraph 仲裁阶段 (48小时)
        D --> E[向陪semicolon员和被举报者开放证据提交];
        E --> F{陪审员匿名投票<br/>(Commit-Reveal Scheme)};
    end

    F --> G{统计投票结果};
    G -- 违规票 > 多数阈值 --> H[裁决: 违规];
    G -- 违规票 <= 多数阈值 --> I[裁决: 不违规];

    subgraph 执行与结算
        H --> J[1. 商品从前端移除<br/>2. 卖家信誉降低/罚款<br/>3. 举报者退还本金+获利<br/>4. 陪审员分享奖励];
        I --> K[1. 商品保留<br/>2. 举报者损失质押金<br/>3. 质押金一部分补偿卖家<br/>4. 另一部分奖励陪审员];
    end
```

### 8.4. 激励模型与平台代币 ($DMT)

为保证治理体系的有效运转，平台需要引入原生代币 `$DMT`。

*   **质押以参与 (Stake-to-Participate)**: 用户必须质押一定数量的 `$DMT` 才能成为陪审员池的一员。质押量与被选中概率正相关（有上限），这保证了陪审员与平台的利益深度绑定。
*   **奖励诚实行为 (Reward for Honesty)**: 陪审员成功参与一次“正确”的裁决（即投票给最终的多数方），将获得 `$DMT` 作为奖励。
*   **惩罚恶意/懒惰行为 (Slashing for Malice/Laziness)**:
    *   **懒惰**: 在规定时间内未投票的陪审员，其部分质押金将被扣罚 (Slashing)。
    *   **恶意**: 持续与最终裁决结果不一致的陪审员，其信誉分会降低，未来被选中的概率也会下降，甚至可能面临更严厉的扣罚。
*   **价值捕获**: `$DMT` 的需求与平台的繁荣度直接挂钩。平台交易越活跃，潜在的争议和治理需求就越多，对陪审员服务的需求也就越大，从而推动了对 `$DT` 的质押需求。 